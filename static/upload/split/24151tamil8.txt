       elif request.form["submit"] == "Delete":

            Pid = request.form['Pid']
            conn = mysql.connector.connect(user='root', password='', host='localhost', database='1productrecomdb')
            cursor = conn.cursor()
            cursor.execute(
                "delete from   protb   where id='" + Pid + "' ")
            conn.commit()
            conn.close()
            alert = 'Record Deleted!'
            return render_template('goback.html', data=alert)





    return render_template('goback.html')






@app.route("/newuser", methods=['GET', 'POST'])
def newuser():
    if request.method == 'POST':

        name1 = request.form['name']
        gender1 = request.form['gender']
        Age = request.form['age']
        email = request.form['email']
        pnumber = request.form['phone']
        address = request.form['address']

        uname = request.form['uname']
        password = request.form['psw']


        conn = mysql.connector.connect(user='root', password='', host='localhost', database='1productrecomdb')
        cursor = conn.cursor()
        cursor.execute(
            "INSERT INTO regtb VALUES ('" + name1 + "','" + gender1 + "','" + Age + "','" + email + "','" + pnumber + "','" + address + "','" + uname + "','" + password + "')")
        conn.commit()
        conn.close()
        # return 'file register successfully'


    return render_template('UserLogin.html')

@app.route("/userlogin", methods=['GET', 'POST'])
def userlogin():
    error = None
    if request.method == 'POST':
        username = request.form['uname']
        password = request.form['password']
        session['uname'] = request.form['uname']

        conn = mysql.connector.connect(user='root', password='', host='localhost', database='1productrecomdb')
        cursor = conn.cursor()
        cursor.execute("SELECT * from regtb where username='" + username + "' and Password='" + password + "'")
        data = cursor.fetchone()
        if data is None:
            alert = 'Username or Password is wrong'
            return render_template('goback.html', data=alert)
        else:

            conn = mysql.connector.connect(user='root', password='', host='localhost', database='1productrecomdb')
            # cursor = conn.cursor()
            cur = conn.cursor()
            cur.execute("SELECT * FROM regtb where username='" + username + "' and Password='" + password + "'")
            data = cur.fetchall()

            return render_template('UserHome.html', data=data )


def recommend():
    # 'Recommend'
    neg = 0
    pas = 0

    conn = mysql.connector.connect(user='root', password='', host='localhost', database='1productrecomdb')
    cursor = conn.cursor()
    cursor.execute("Truncate table  temptb")
    conn.commit()
    conn.close()

    conn = mysql.connector.connect(user='root', password='', host='localhost', database='1productrecomdb')
    cur = conn.cursor()
    cur.execute("SELECT Distinct ProductId,Image,ProductName,Price FROM reviewtb where Result='Postive' ")
    data1 = cur.fetchall()
    for row in data1:

        conn = mysql.connector.connect(user='root', password='', host='localhost', database='1productrecomdb')
        cursor = conn.cursor()
        cursor.execute(
            "SELECT  count(*) as count FROM reviewtb WHERE ProductId  ='" + row[0] + "' and Result='Postive'  ")
        data2 = cursor.fetchone()
        if data2:
            pas = data2[0]

        else:
            pas = 0

        conn = mysql.connector.connect(user='root', password='', host='localhost', database='1productrecomdb')
        cursor = conn.cursor()
        cursor.execute(
            "SELECT  count(*) as count FROM reviewtb WHERE ProductId  ='" + row[0] + "' and Result='negative'  ")
        data3 = cursor.fetchone()
        if data3:
            neg = data3[0]

        else:
            neg = 0

        if pas >= neg:
            conn = mysql.connector.connect(user='root', password='', host='localhost', database='1productrecomdb')
            cur = conn.cursor()
            cur.execute(
                "SELECT ProductId,CompanyName,ProductType,ProductName,Price,Image FROM reviewtb where ProductId  ='" + row[0] + "' ")
            data22 = cur.fetchone()
            if data22:
                s1 = data22[0]
                s2 = data22[1]
                s3 = data22[2]
                s4 = data22[3]
                s5 = data22[4]
                s6 = data22[5]


            else:
                neg = 0

            conn = mysql.connector.connect(user='root', password='', host='localhost', database='1productrecomdb')
            cursor = conn.cursor()
            cursor.execute(
                "insert into  temptb values('" + s1 + "','" + s2 + "','" + s3 + "','" + s4 + "','" + s5 + "','" + s6 + "')")
            conn.commit()
            conn.close()

@app.route("/Search")
def Search():

    recommend()

    conn = mysql.connector.connect(user='root', password='', host='localhost', database='1productrecomdb')
    cur = conn.cursor()
    cur.execute("SELECT * FROM protb ")
    data = cur.fetchall()

    conn = mysql.connector.connect(user='root', password='', host='localhost', database='1productrecomdb')
    cur = conn.cursor()
    cur.execute("SELECT ProductId,Image,ProductName,Price FROM temptb  ")
    data1 = cur.fetchall()

    return render_template('Search.html',data=data , data1=data1 )

@app.route("/typesearch", methods=['GET', 'POST'])
def typesearch():

    cname = request.form['Cname']
    ptype = request.form['Ptype']


    conn = mysql.connector.connect(user='root', password='', host='localhost', database='1productrecomdb')
    cursor = conn.cursor()
    cursor.execute("SELECT * from protb where CompanyName='" + cname + "' and ProductType='" + ptype + "'")
    data = cursor.fetchone()
    if data is None:
        alert = 'Product Not Found!'
        return render_template('goback.html', data=alert)
    else:

        recommend()

        conn = mysql.connector.connect(user='root', password='', host='localhost', database='1productrecomdb')
        cur = conn.cursor()
        cur.execute("SELECT * FROM protb where CompanyName='" + cname + "' and ProductType='" + ptype + "' ")
        data = cur.fetchall()

        conn = mysql.connector.connect(user='root', password='', host='localhost', database='1productrecomdb')
        cur = conn.cursor()
        cur.execute("SELECT ProductId,Image,ProductName,Price FROM temptb where CompanyName='" + cname + "' and ProductType='" + ptype + "' ")
        data1 = cur.fetchall()

        return render_template('Search.html', data=data, data1=data1)





@app.route("/fullInfo")
def fullInfo():
    pid = request.args.get('pid')
    session['pid'] = pid

    rat1 = ''
    ra